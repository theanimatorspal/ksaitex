% METADATA DEFINITIONS (Hidden from PDF output)
% \VAR{ document_class, default='article', tab='लेआउट', label='कागजको ढाँचा', type='select', options='article|report|book' }
% \VAR{ top_margin, default='1in', tab='लेआउट', label='माथिल्लो मार्जिन' }
% \VAR{ bottom_margin, default='1in', tab='लेआउट', label='तल्लो मार्जिन' }
% \VAR{ left_margin, default='1in', tab='लेआउट', label='बायाँ मार्जिन' }
% \VAR{ right_margin, default='1in', tab='लेआउट', label='दायाँ मार्जिन' }
% \VAR{ script, default='DEVANAGARI', tab='लेआउट', label='लिपि प्रणाली', type='select', options='DEVANAGARI|LATIN' }

% \VAR{ font_file, default='Tiro Devanagari Sanskrit', tab='लेआउट', label='मुख्य फन्ट' }
% \VAR{ extra_preamble, default='', tab='उन्नत', label='अतिरिक्त कोड' }
% \MAGIC{ section, label='संख्याहीन शीर्षक', tab='ढाँचा', args='title:text:नयाँ संख्याहीन शीर्षक', command='\section*{VAR_title}' }
% \MAGIC{ subsection, label='संख्याहीन उपशीर्षक', tab='ढाँचा', args='title:text:नयाँ संख्याहीन उपशीर्षक', command='\subsection*{VAR_title}' }
% \MAGIC{ box, label='बक्स (Box)', tab='ढाँचा', args='title:text:शीर्षक|color:select,red,blue,green,orange,black:red|body:textarea:सामग्री यहाँ लेख्नुहोस्...', command='\begin{tcolorbox}[title=VAR_title, colback=VAR_color!5!white, colframe=VAR_color!75!black] VAR_body \end{tcolorbox}' }
% \MAGIC{ toc, label='विषय सूची (TOC)', tab='संरचना', args='title:text:विषय सूची|nums:select,devanagari,latin:devanagari', command='\renewcommand{\contentsname}{VAR_title} \ifthenelse{\equal{VAR_nums}{devanagari}}{ \renewcommand{\thepage}{\devanagaridigits{\value{page}}} \renewcommand{\thesection}{\devanagaridigits{\value{section}}} \renewcommand{\thesubsection}{\thesection.\devanagaridigits{\value{subsection}}} }{ \pagenumbering{arabic} \renewcommand{\thesection}{\arabic{section}} \renewcommand{\thesubsection}{\thesection.\arabic{subsection}} } \tableofcontents' }

% \MAGIC{ page_break, label='नयाँ पृष्ठ', tab='पृष्ठ', command='\pagebreak' }
% \MAGIC{ devanagari_num, label='देवनागरी अंक', tab='पृष्ठ', command='\renewcommand{\thepage}{\devanagaridigits{\value{page}}}' }
% \MAGIC{ devanagari_alph, label='देवनागरी अक्षर', tab='पृष्ठ', command='\renewcommand{\thepage}{\devanagarialph{\value{page}}}' }
% \MAGIC{ horizontal_rule, label='तेर्सो रेखा', tab='पृष्ठ', command='\hrule' }
% \MAGIC{ empty_page, label='पृष्ठ संख्या नदेखाउनुहोस्', tab='पृष्ठ', command='\thispagestyle{empty}' }
% \MAGIC{ set_page_counter, label='पृष्ठ संख्या सेट गर्नुहोस्', tab='पृष्ठ', args='num:number:1', command='\setcounter{page}{VAR_num}' }

% \VAR{ header_rule, default='On', tab='हेडर-फुटर', label='हेडर लाइन', type='select', options='On|Off' }
% \VAR{ footer_rule, default='Off', tab='हेडर-फुटर', label='फुटर लाइन', type='select', options='On|Off' }

% \VAR{ header_left, default='None', tab='हेडर-फुटर', label='हेडर बायाँ', type='select', options='None|Section|Page|Custom' }
% \VAR{ header_left_text, default='', tab='हेडर-फुटर', label='— कस्टम पाठ' }
% \VAR{ header_right, default='None', tab='हेडर-फुटर', label='हेडर दायाँ', type='select', options='None|Section|Page|Custom' }
% \VAR{ header_right_text, default='', tab='हेडर-फुटर', label='— कस्टम पाठ' }
% \VAR{ header_center, default='None', tab='हेडर-फुटर', label='हेडर मध्य', type='select', options='None|Section|Page|Custom' }
% \VAR{ header_center_text, default='', tab='हेडर-फुटर', label='— कस्टम पाठ' }
% \VAR{ footer_left, default='None', tab='हेडर-फुटर', label='फुटर बायाँ', type='select', options='None|Section|Page|Custom' }
% \VAR{ footer_left_text, default='', tab='हेडर-फुटर', label='— कस्टम पाठ' }
% \VAR{ footer_right, default='None', tab='हेडर-फुटर', label='फुटर दायाँ', type='select', options='None|Section|Page|Custom' }
% \VAR{ footer_right_text, default='', tab='हेडर-फुटर', label='— कस्टम पाठ' }
% \VAR{ footer_center, default='Page', tab='हेडर-फुटर', label='फुटर मध्य', type='select', options='None|Section|Page|Custom' }
% \VAR{ footer_center_text, default='', tab='हेडर-फुटर', label='— कस्टम पाठ' }

\documentclass{\VAR{document_class}}

\usepackage{fontspec}
\usepackage{polyglossia}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{tcolorbox}
\usepackage{ifthen}

\geometry{
    top=\VAR{top_margin},
    bottom=\VAR{bottom_margin},
    left=\VAR{left_margin},
    right=\VAR{right_margin}
}

% --- Devanagari Page Numbering Macros ---
\makeatletter
\def\devanagaridigits#1{\expandafter\@devanagaridigits\number#1@}
\def\@devanagaridigits#1{%
  \ifx#1@\else
    \ifcase#1 ०\or १\or २\or ३\or ४\or ५\or ६\or ७\or ८\or ९\fi
    \expandafter\@devanagaridigits
  \fi
}

\def\devanagarialph#1{\expandafter\@devanagarialph\number#1}
\def\@devanagarialph#1{%
  \ifcase#1\or अ\or आ\or इ\or ई\or उ\or ऊ\or ऋ\or ॠ\or ऌ\or ॡ\or ए\or ऐ\or ओ\or औ\or क\or ख\or ग\or घ\or ङ\or च\or छ\or ज\or झ\or ञ\or ट\or ठ\or ड\or ढ\or ण\or त\or थ\or द\or ध\or न\or प\or फ\or ब\or भ\or म\or य\or र\or ल\or व\or श\or ष\or स\or ह\or ळ\or क्ष\or ज्ञ\else\@ctrerr\fi
}
\makeatother

% --- Page Numbering Style Selection ---
% \BLOCK{ if page_numbering == 'devanagari_num' }
%     \renewcommand{\thepage}{\devanagaridigits{\value{page}}}
% \BLOCK{ elif page_numbering == 'devanagari_alph' }
%     \renewcommand{\thepage}{\devanagarialph{\value{page}}}
% \BLOCK{ else }
%     \pagenumbering{arabic}
% \BLOCK{ endif }

% --- Page Number Placement and Customization ---
\pagestyle{fancy}
\fancyhf{} % clear all header and footer fields

% -- Rules --
\BLOCK{ if header_rule == 'On' }
    \renewcommand{\headrulewidth}{0.4pt}
\BLOCK{ else }
    \renewcommand{\headrulewidth}{0pt}
\BLOCK{ endif }

\BLOCK{ if footer_rule == 'On' }
    \renewcommand{\footrulewidth}{0.4pt}
\BLOCK{ else }
    \renewcommand{\footrulewidth}{0pt}
\BLOCK{ endif }

% -- Header Left --
\BLOCK{ if header_left == 'Section' }
    \lhead{\leftmark}
\BLOCK{ elif header_left == 'Page' }
    \lhead{\thepage}
\BLOCK{ elif header_left == 'Custom' }
    \lhead{\VAR{header_left_text}}
\BLOCK{ endif }

% -- Header Right --
\BLOCK{ if header_right == 'Section' }
    \rhead{\leftmark}
\BLOCK{ elif header_right == 'Page' }
    \rhead{\thepage}
\BLOCK{ elif header_right == 'Custom' }
    \rhead{\VAR{header_right_text}}
\BLOCK{ endif }

% -- Footer Center --
\BLOCK{ if footer_center == 'Section' }
    \cfoot{\leftmark}
\BLOCK{ elif footer_center == 'Page' }
    \cfoot{\thepage}
\BLOCK{ elif footer_center == 'Custom' }
    \cfoot{\VAR{footer_center_text}}
\BLOCK{ endif }

% --- Font Configuration ---
\BLOCK{ if script == 'DEVANAGARI' }
    \setmainfont[Script=Devanagari, AutoFakeBold=1.8]{\VAR{font_file}}
\BLOCK{ else }
    \setmainfont[AutoFakeBold=2.5]{\VAR{font_file}}
\BLOCK{ endif }

\VAR{ extra_preamble }

\begin{document}

\VAR{ content }

\end{document}
