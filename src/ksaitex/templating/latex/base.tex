% METADATA DEFINITIONS (Hidden from PDF output)
% \VAR{ document_class, default='article', tab='लेआउट', label='कागजको ढाँचा', type='select', options='article|report|book' }
% \VAR{ top_margin, default='1in', tab='लेआउट', label='माथिल्लो मार्जिन' }
% \VAR{ bottom_margin, default='1in', tab='लेआउट', label='तल्लो मार्जिन' }
% \VAR{ left_margin, default='1in', tab='लेआउट', label='बायाँ मार्जिन' }
% \VAR{ right_margin, default='1in', tab='लेआउट', label='दायाँ मार्जिन' }
% \VAR{ script, default='DEVANAGARI', tab='लिपि र भाषा', label='लिपि प्रणाली', type='select', options='DEVANAGARI|LATIN' }
% \VAR{ page_numbering, default='arabic', tab='पृष्ठ संख्या', label='संख्या प्रकार', type='select', options='arabic|devanagari_num|devanagari_alph' }
% \VAR{ page_placement, default='bottom-center', tab='पृष्ठ संख्या', label='स्थिति', type='select', options='bottom-left|bottom-center|bottom-right|top-left|top-center|top-right' }
% \VAR{ start_page, default='1', tab='पृष्ठ संख्या', label='यहाँबाट सुरु' }
% \VAR{ font_file, default='Tiro Devanagari Sanskrit', tab='फन्ट', label='मुख्य फन्ट' }
% \VAR{ extra_preamble, default='', tab='उन्नत', label='अतिरिक्त कोड' }
% \MAGIC{ page_break, label='नयाँ पृष्ठ', tab='लेआउट', command='\pagebreak' }
% \MAGIC{ section, label='खण्ड (Section)', tab='ढाँचा', args='title:text:नयाँ खण्ड', command='\section{VAR_title}' }
% \MAGIC{ subsection, label='उपखण्ड (Subsection)', tab='ढाँचा', args='title:text:नयाँ उपखण्ड', command='\subsection{VAR_title}' }
% \MAGIC{ box, label='बक्स (Box)', tab='ढाँचा', args='title:text:शीर्षक|color:select,red,blue,green,orange,black:red|body:textarea:सामग्री यहाँ लेख्नुहोस्...', command='\begin{tcolorbox}[title=VAR_title, colback=VAR_color!5!white, colframe=VAR_color!75!black] VAR_body \end{tcolorbox}' }
% \MAGIC{ devanagari_num, label='देवनागरी अंक', tab='पृष्ठ संख्या', command='\renewcommand{\thepage}{\devanagaridigits{\value{page}}}' }
% \MAGIC{ devanagari_alph, label='देवनागरी अक्षर', tab='पृष्ठ संख्या', command='\renewcommand{\thepage}{\devanagarialph{\value{page}}}' }
% \MAGIC{ horizontal_rule, label='तेर्सो रेखा', tab='लेआउट', command='\hrule' }

\documentclass{\VAR{document_class}}

\usepackage{fontspec}
\usepackage{polyglossia}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{tcolorbox}

\geometry{
    top=\VAR{top_margin},
    bottom=\VAR{bottom_margin},
    left=\VAR{left_margin},
    right=\VAR{right_margin}
}

% --- Devanagari Page Numbering Macros ---
\makeatletter
\def\devanagaridigits#1{\expandafter\@devanagaridigits\number#1@}
\def\@devanagaridigits#1{%
  \ifx#1@\else
    \ifcase#1 ०\or १\or २\or ३\or ४\or ५\or ६\or ७\or ८\or ९\fi
    \expandafter\@devanagaridigits
  \fi
}

\def\devanagarialph#1{\expandafter\@devanagarialph\number#1}
\def\@devanagarialph#1{%
  \ifcase#1\or अ\or आ\or इ\or ई\or उ\or ऊ\or ऋ\or ॠ\or ऌ\or ॡ\or ए\or ऐ\or ओ\or औ\or क\or ख\or ग\or घ\or ङ\or च\or छ\or ज\or झ\or ञ\or ट\or ठ\or ड\or ढ\or ण\or त\or थ\or द\or ध\or न\or प\or फ\or ब\or भ\or म\or य\or र\or ल\or व\or श\or ष\or स\or ह\or ळ\or क्ष\or ज्ञ\else\@ctrerr\fi
}
\makeatother

% --- Page Numbering Style Selection ---
\BLOCK{ if page_numbering == 'devanagari_num' }
    \renewcommand{\thepage}{\devanagaridigits{\value{page}}}
\BLOCK{ elif page_numbering == 'devanagari_alph' }
    \renewcommand{\thepage}{\devanagarialph{\value{page}}}
\BLOCK{ else }
    \pagenumbering{arabic}
\BLOCK{ endif }

% --- Page Number Placement ---
\pagestyle{fancy}
\fancyhf{} % clear all header and footer fields
\renewcommand{\headrulewidth}{0pt} % Remove header line

\BLOCK{ if page_placement == 'bottom-left' }
    \lfoot{\thepage}
\BLOCK{ elif page_placement == 'bottom-center' }
    \cfoot{\thepage}
\BLOCK{ elif page_placement == 'bottom-right' }
    \rfoot{\thepage}
\BLOCK{ elif page_placement == 'top-left' }
    \lhead{\thepage}
\BLOCK{ elif page_placement == 'top-center' }
    \chead{\thepage}
\BLOCK{ elif page_placement == 'top-right' }
    \rhead{\thepage}
\BLOCK{ endif }

% --- Font Configuration ---
\BLOCK{ if script == 'DEVANAGARI' }
    \setmainfont[Script=Devanagari, AutoFakeBold=2.5]{\VAR{font_file}}
\BLOCK{ else }
    \setmainfont[AutoFakeBold=2.5]{\VAR{font_file}}
\BLOCK{ endif }

\VAR{ extra_preamble }

\begin{document}
\setcounter{page}{\VAR{start_page}}

\VAR{ content }

\end{document}
